
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matching Equity Entries - View All</title>

    <!-- Shared Eskala form navbar styles -->
    <link rel="stylesheet" href="/web/styles/form-navbar.css" />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f5f5f5;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1800px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      /* Header */
      .header {
        background: #134e4a;
        color: white;
        padding: 24px 30px;
      }
      .header h1 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 8px;
      }
      .header p {
        opacity: 0.9;
        font-size: 14px;
      }

      /* Stats */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1px;
        background: #e5e7eb;
        border-bottom: 1px solid #e5e7eb;
      }
      .stat-card {
        background: white;
        padding: 20px 24px;
        text-align: center;
      }
      .stat-label {
        font-size: 12px;
        color: #6b7280;
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
      }
      .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #134e4a;
      }

      /* Back link (we keep it for intra-page nav; navbar has its own Back too) */
      .back-link {
        display: inline-block;
        padding: 8px 16px;
        margin: 20px 24px;
        color: #134e4a;
        text-decoration: none;
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.2s;
      }
      .back-link:hover {
        background: #f0fdfa;
      }

      /* Controls */
      .controls {
        padding: 20px 24px;
        background: #f9fafb;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }
      .search-box {
        flex: 1;
        min-width: 300px;
      }
      .search-box input {
        width: 100%;
        padding: 10px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s;
      }
      .search-box input:focus {
        outline: none;
        border-color: #134e4a;
        box-shadow: 0 0 0 3px rgba(19, 78, 74, 0.1);
      }

      .filter-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      select {
        padding: 10px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        background: white;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 140px;
      }
      select:focus {
        outline: none;
        border-color: #134e4a;
        box-shadow: 0 0 0 3px rgba(19, 78, 74, 0.1);
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
      }
      .btn-refresh {
        background: #134e4a;
        color: white;
      }
      .btn-refresh:hover {
        background: #0f3f3a;
        transform: translateY(-1px);
      }
      .btn-download {
        background: #3b82f6;
        color: white;
      }
      .btn-download:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }

      /* Bulk upload band */
      .bulk-upload-section {
        background: linear-gradient(135deg, #134e4a 0%, #0f3f3a 100%);
        padding: 24px 30px;
        border-bottom: 1px solid #e5e7eb;
      }
      .bulk-upload-title {
        color: white;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 16px;
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .bulk-upload-content {
        display: flex;
        gap: 20px;
        align-items: center;
        flex-wrap: wrap;
      }
      .bulk-upload-info {
        flex: 1;
        min-width: 280px;
        color: rgba(255, 255, 255, 0.9);
        font-size: 14px;
        line-height: 1.6;
      }
      .bulk-upload-actions {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
      }

      .btn-template {
        background: white;
        color: #134e4a;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .btn-template:hover {
        background: #f0f9ff;
        transform: translateY(-1px);
      }
      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }
      .file-input-wrapper input[type="file"] {
        position: absolute;
        left: -9999px;
      }
      .btn-upload {
        background: #fbbf24;
        color: #78350f;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .btn-upload:hover {
        background: #f59e0b;
        transform: translateY(-1px);
      }

      .upload-progress {
        display: none;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 16px;
        margin-top: 16px;
        backdrop-filter: blur(10px);
      }
      .upload-progress.active {
        display: block;
      }
      .progress-bar-container {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 4px;
        height: 8px;
        overflow: hidden;
        margin-bottom: 8px;
      }
      .progress-bar {
        background: #fbbf24;
        height: 100%;
        transition: width 0.3s;
        border-radius: 4px;
      }
      .progress-text {
        color: white;
        font-size: 13px;
        text-align: center;
      }

      .upload-result {
        display: none;
        padding: 16px 20px;
        margin: 16px 24px;
        border-radius: 6px;
        font-size: 14px;
        line-height: 1.6;
      }
      .upload-result.active {
        display: block;
      }
      .upload-result.success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #6ee7b7;
      }
      .upload-result.error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fca5a5;
      }
      .upload-result strong {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
      }
      .upload-result-details {
        font-size: 13px;
        margin-top: 8px;
        padding-left: 20px;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
        padding: 20px;
      }
      #table-loading,
      #table-no-data {
        text-align: center;
        padding: 60px 20px;
        color: #6b7280;
        font-size: 16px;
      }
      #table-loading {
        display: block;
      }
      #table-no-data {
        display: none;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        display: none;
      }
      thead {
        background: #f9fafb;
        position: sticky;
        top: 0;
        z-index: 10;
        border-bottom: 2px solid #e5e7eb;
      }
      th {
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        color: #374151;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
      }
      tbody tr {
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.15s;
      }
      tbody tr:hover {
        background: #f9fafb;
      }

      /* highlight recent edits */
      tbody tr[data-recently-edited="true"] {
        background-color: #fef3c7;
      }
      tbody tr[data-recently-edited="true"]:hover {
        background-color: #fde68a;
      }

      td {
        padding: 12px 16px;
        color: #1f2937;
        white-space: nowrap;
      }
      td small {
        font-size: 11px;
        color: #6b7280;
        display: block;
        margin-top: 2px;
      }

      .action-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        margin-right: 4px;
      }
      .edit-btn {
        background: #f59e0b;
        color: white;
      }
      .edit-btn:hover {
        background: #d97706;
      }
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      .delete-btn:hover {
        background: #dc2626;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        overflow-y: auto;
      }
      .modal.active {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 40px 20px;
      }
      .modal-content {
        background: white;
        border-radius: 8px;
        padding: 30px;
        max-width: 800px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e5e7eb;
      }
      .modal-header h2 {
        font-size: 20px;
        color: #134e4a;
        margin: 0;
      }
      .close-modal {
        background: none;
        border: none;
        font-size: 28px;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: all 0.2s;
      }
      .close-modal:hover {
        background: #f3f4f6;
        color: #1f2937;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 20px;
      }
      .form-group {
        display: flex;
        flex-direction: column;
      }
      .form-group.full-width {
        grid-column: 1 / -1;
      }
      .form-group label {
        font-weight: 600;
        margin-bottom: 6px;
        color: #374151;
        font-size: 13px;
      }
      .form-group input,
      .form-group select,
      .form-group textarea {
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: all 0.2s;
      }
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #134e4a;
        box-shadow: 0 0 0 3px rgba(19, 78, 74, 0.1);
      }
      .form-group textarea {
        resize: vertical;
        min-height: 80px;
      }

      .section-title {
        font-size: 16px;
        font-weight: 600;
        color: #134e4a;
        margin: 25px 0 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
      }
      .submit-btn {
        background-color: #134e4a;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        margin-top: 10px;
      }
      .submit-btn:hover {
        background-color: #0f3f3a;
        transform: translateY(-1px);
      }

      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
        }
        .controls {
          flex-direction: column;
        }
        .search-box {
          width: 100%;
        }
        .filter-group {
          width: 100%;
          justify-content: stretch;
        }
        select,
        .btn {
          flex: 1;
        }
        .form-grid {
          grid-template-columns: 1fr;
        }
        .modal-content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Shared Eskala Navbar (same structure/behavior as your sample) -->
    <nav class="esk-nav" role="navigation" aria-label="Primary">
      <div class="esk-nav__inner">
        <!-- Brand -->
        <a class="esk-nav__brand" id="esk-form-brand" href="#">
          <img src="/Assets/Eskala-Logo.png" alt="" />
          <span>Eskala</span>
        </a>

        <div class="esk-nav__spacer"></div>

        <!-- Language Dropdown -->
        <div class="esk-nav__group">
          <button
            class="esk-nav__btn"
            type="button"
            data-menu="lang"
            aria-haspopup="true"
            aria-expanded="false"
            aria-controls="menu-lang"
          >
            English ‚ñæ
          </button>
          <div class="esk-nav__menu" id="menu-lang" role="menu" hidden>
            <a href="#" role="menuitem" data-lang="en">English</a>
            <a href="#" role="menuitem" data-lang="es">Espa√±ol</a>
          </div>
        </div>

        <!-- Back -->
        <a
          href="/web/matching-equity.html"
          id="esk-form-home"
          class="esk-nav__btn esk-nav__btn--ghost"
          >‚Üê Back</a
        >
      </div>
    </nav>

    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>Matching Equity Entries</h1>
        <p>
          View and manage all micro equity matching entries with search and
          filtering
        </p>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Entries</div>
          <div class="stat-value" id="total-entries">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Investment (L)</div>
          <div class="stat-value" id="total-investment-l">L 0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Investment ($)</div>
          <div class="stat-value" id="total-investment-usd">$ 0.00</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Total Reported Shares</div>
          <div class="stat-value" id="total-shares">0</div>
        </div>
      </div>

      <!-- Bulk Upload -->
      <div class="bulk-upload-section">
        <div class="bulk-upload-title">üìä Bulk CSV Upload</div>
        <div class="bulk-upload-content">
          <div class="bulk-upload-info">
            Upload multiple entries at once using a CSV file. Download the
            template below, fill it with your data following the same format,
            and upload it back.
          </div>
          <div class="bulk-upload-actions">
            <button class="btn-template" id="download-template-btn">
              üìÑ Download Template
            </button>
            <div class="file-input-wrapper">
              <button class="btn-upload" id="upload-csv-label">
                üì§ Upload CSV
              </button>
              <input type="file" id="upload-csv-input" accept=".csv" />
            </div>
          </div>
        </div>
        <div class="upload-progress" id="upload-progress">
          <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
          </div>
          <div class="progress-text" id="progress-text">Processing...</div>
        </div>
      </div>

      <!-- Upload result -->
      <div class="upload-result" id="upload-result"></div>

      <!-- Optional in-page Back (kept) -->
      <a href="/web/matching-equity.html" class="back-link"
        >‚Üê Back to Matching Form</a
      >

      <!-- Controls -->
      <div class="controls">
        <div class="search-box">
          <input
            type="text"
            id="search-input"
            data-en-placeholder="üîç Search by partner, comments, technician, or user..."
            data-es-placeholder="üîç Buscar por socio, comentarios, t√©cnico o usuario..."
            placeholder="üîç Search by partner, comments, technician, or user..."
          />
        </div>

        <div class="filter-group">
          <select id="year-filter">
            <option value="">All Years</option>
          </select>

          <select id="proposal-filter">
            <option value="">All Proposals</option>
          </select>

          <select id="transaction-filter">
            <option value="">All Transactions</option>
          </select>

          <button class="btn btn-refresh" id="refresh-btn">üîÑ Refresh</button>

          <button class="btn btn-download" id="download-csv-btn">
            üì• Download CSV
          </button>
        </div>
      </div>

      <!-- Table -->
      <div class="table-container">
        <div id="table-loading">Loading entries...</div>
        <div id="table-no-data" style="display: none">No entries found</div>

        <table id="entries-table">
          <thead>
            <tr>
              <th>Partner Name</th>
              <th>Year</th>
              <th>Reported Shares</th>
              <th>Share Capital</th>
              <th>Expected %</th>
              <th>Investment (L)</th>
              <th>Investment ($)</th>
              <th>Proposal State</th>
              <th>Transaction Type</th>
              <th>Jan (L)</th>
              <th>Feb (L)</th>
              <th>Mar (L)</th>
              <th>Apr (L)</th>
              <th>May (L)</th>
              <th>Jun (L)</th>
              <th>Jul (L)</th>
              <th>Aug (L)</th>
              <th>Sep (L)</th>
              <th>Oct (L)</th>
              <th>Nov (L)</th>
              <th>Dec (L)</th>
              <th>Technician</th>
              <th>Business Category</th>
              <th>Company Type</th>
              <th>Community</th>
              <th>Municipality</th>
              <th>State</th>
              <th>Comments</th>
              <th>File</th>
              <th>Last Edited</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="entries-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Matching Entry</h2>
          <button class="close-modal" id="close-modal">&times;</button>
        </div>

        <form id="edit-form">
          <input type="hidden" id="edit-id" />

          <div class="form-grid">
            <div class="form-group">
              <label>Partner Name</label>
              <input type="text" id="edit-partner-name" />
            </div>

            <div class="form-group">
              <label>Year</label>
              <input type="number" id="edit-year" />
            </div>

            <div class="form-group">
              <label>Reported Shares</label>
              <input type="number" step="0.01" id="edit-reported-shares" />
            </div>

            <div class="form-group">
              <label>Share Capital Multiplied</label>
              <input type="number" step="0.01" id="edit-share-capital" />
            </div>

            <div class="form-group">
              <label>Expected Profit %</label>
              <input type="number" step="0.01" id="edit-expected-pct" />
            </div>

            <div class="form-group">
              <label>Investment (L)</label>
              <input type="number" step="0.01" id="edit-investment-l" />
            </div>

            <div class="form-group">
              <label>Investment ($)</label>
              <input type="number" step="0.01" id="edit-investment-usd" />
            </div>

            <div class="form-group">
              <label>Exchange Rate</label>
              <input type="number" step="0.0001" id="edit-exchange-rate" />
            </div>

            <div class="form-group">
              <label>Proposal State</label>
              <select id="edit-proposal-state">
                <option value="">Select state</option>
                <option value="Presented">Presented</option>
                <option value="Executed">Executed</option>
                <option value="Rejected">Rejected</option>
                <option value="Accepted">Accepted</option>
                <option value="To Pitch">To Pitch</option>
              </select>
            </div>

            <div class="form-group">
              <label>Transaction Type</label>
              <select id="edit-transaction-type">
                <option value="">Select type</option>
                <option value="Conversion">Conversion</option>
                <option value="Disbursement">Disbursement</option>
              </select>
            </div>
          </div>

          <div class="section-title">Monthly Distributions (L)</div>
          <div class="form-grid">
            <div class="form-group">
              <label>January</label
              ><input type="number" step="0.01" id="edit-january" value="0" />
            </div>
            <div class="form-group">
              <label>February</label
              ><input type="number" step="0.01" id="edit-february" value="0" />
            </div>
            <div class="form-group">
              <label>March</label
              ><input type="number" step="0.01" id="edit-march" value="0" />
            </div>
            <div class="form-group">
              <label>April</label
              ><input type="number" step="0.01" id="edit-april" value="0" />
            </div>
            <div class="form-group">
              <label>May</label
              ><input type="number" step="0.01" id="edit-may" value="0" />
            </div>
            <div class="form-group">
              <label>June</label
              ><input type="number" step="0.01" id="edit-june" value="0" />
            </div>
            <div class="form-group">
              <label>July</label
              ><input type="number" step="0.01" id="edit-july" value="0" />
            </div>
            <div class="form-group">
              <label>August</label
              ><input type="number" step="0.01" id="edit-august" value="0" />
            </div>
            <div class="form-group">
              <label>September</label
              ><input type="number" step="0.01" id="edit-september" value="0" />
            </div>
            <div class="form-group">
              <label>October</label
              ><input type="number" step="0.01" id="edit-october" value="0" />
            </div>
            <div class="form-group">
              <label>November</label
              ><input type="number" step="0.01" id="edit-november" value="0" />
            </div>
            <div class="form-group">
              <label>December</label
              ><input type="number" step="0.01" id="edit-december" value="0" />
            </div>
          </div>

          <div class="section-title">Additional Information</div>
          <div class="form-grid">
            <div class="form-group">
              <label>Technician</label>
              <input type="text" id="edit-technician" />
            </div>

            <div class="form-group">
              <label>Business Category</label>
              <input type="text" id="edit-business-category" />
            </div>

            <div class="form-group">
              <label>Company Type</label>
              <input type="text" id="edit-company-type" />
            </div>

            <div class="form-group">
              <label>Community</label>
              <input type="text" id="edit-community" />
            </div>

            <div class="form-group">
              <label>Municipality</label>
              <input type="text" id="edit-municipality" />
            </div>

            <div class="form-group">
              <label>State</label>
              <input type="text" id="edit-state" />
            </div>

            <div class="form-group full-width">
              <label>Comments</label>
              <textarea id="edit-comments"></textarea>
            </div>
          </div>

          <button type="submit" class="submit-btn">Update Entry</button>
        </form>
      </div>
    </div>

    <!-- Language bootstrap (mirrors your sample) -->
    <script>
      (function () {
        const LANG_KEY = "eskala_lang";

        window.setLanguage = function setLanguage(lang) {
          lang = lang === "es" ? "es" : "en";

          // Text swaps
          document.querySelectorAll("[data-en]").forEach((el) => {
            const text = el.getAttribute("data-" + lang);
            if (text != null) el.textContent = text;
          });

          // Placeholders
          document.querySelectorAll("[data-en-placeholder]").forEach((el) => {
            const ph = el.getAttribute("data-" + lang + "-placeholder");
            if (ph != null) el.placeholder = ph;
          });

          // Also support our input above
          document
            .querySelectorAll("[data-en-placeholder][data-es-placeholder]")
            .forEach((el) => {
              const ph = el.getAttribute("data-" + lang + "-placeholder");
              if (ph != null) el.placeholder = ph;
            });

          // <html lang>
          document.documentElement.setAttribute("lang", lang);

          // Language button label
          const btn = document.querySelector('[data-menu="lang"]');
          if (btn)
            btn.innerHTML = (lang === "es" ? "Espa√±ol" : "English") + " ‚ñæ";

          // Back link text + target (preserve query string flags)
          const home = document.getElementById("esk-form-home");
          if (home) {
            const qs = location.search || "";
            home.textContent = lang === "es" ? "‚Üê Atr√°s" : "‚Üê Back";
            home.setAttribute("href", "/web/matching-equity.html" + qs);
          }
        };

        // Apply saved/default language ASAP
        const saved = localStorage.getItem(LANG_KEY) || "en";
        window.setLanguage(saved);
      })();
    </script>

    <!-- Your page logic -->
    <script src="/js/matching-equity-table_client.js"></script>

    <!-- Shared navbar behavior (role-based, language menu, focus mgmt, etc.) -->
    <script src="/js/form-navbar.js" defer></script>
  </body>
</html>